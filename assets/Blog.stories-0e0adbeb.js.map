{"version":3,"file":"Blog.stories-0e0adbeb.js","sources":["../../src/pages/Blog.tsx"],"sourcesContent":["import Button from \"@components/buttons/Button\";\nimport MultiSelection, {\n  Option,\n  SingleSelection,\n} from \"@components/input/MultiSelection\";\nimport SearchField from \"@components/input/SearchField\";\nimport BlogCard from \"@features/blog/components/BlogCard\";\nimport BlogCardLoading from \"@features/blog/components/BlogCardLoading\";\nimport { devdottoArticlesMeta } from \"@features/blog/services/devdottoArticle\";\nimport { DevdottoArticleMeta } from \"@features/blog/types/devdottoArticle\";\nimport sortFuncFromOption, {\n  sortByPopularity,\n  SortOption,\n  sortOptions,\n} from \"@features/blog/utils/sortFuncs\";\nimport useLocalStorage from \"@hooks/useLocalStorage\";\nimport useMediaQuery from \"@hooks/useMediaQuery\";\nimport { useQueryParams } from \"@hooks/useQueryParams\";\nimport cn from \"@styles/cssUtils\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { decodeArrayAsCsv, encodeArrayAsCsv } from \"@utils/encodeQueryParams\";\nimport FadeIn from \"react-fade-in\";\nimport { RiRefreshFill } from \"react-icons/ri\";\nimport { SiDevdotto, SiMedium } from \"react-icons/si\";\nimport { useNavigate } from \"react-router-dom\";\n\nconst searchFilter = (searchText: string, item: DevdottoArticleMeta) => {\n  const search = searchText.toLowerCase();\n  return (\n    search.length === 0 ||\n    item.title.toLowerCase().includes(search) ||\n    item.description.toLowerCase().includes(search) ||\n    (typeof item.tag_list !== \"string\" &&\n      item.tag_list.some((tag) => tag.toLowerCase().includes(search)))\n  );\n};\n\ntype BlogOptions = {\n  tags: readonly Option[];\n  sort: SortOption;\n  searchText: string;\n};\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nconst defaultSort = sortOptions[0]!;\n\nconst articlesToDisplay = 30;\n\nconst Blog = () => {\n  const [selectedTags, setSelectedTags] = useState<readonly Option[]>([]);\n  const [selectedSort, setSelectedSort] = useState<SortOption>(defaultSort);\n  const [tagOptions, setTagOptions] = useState<readonly Option[]>([]);\n  const [searchText, setSearchText] = useState<string>(\"\");\n\n  const { status, data: articles } = useQuery(\n    [\"devdotto\", \"articlesMeta\", articlesToDisplay, 1],\n    devdottoArticlesMeta(articlesToDisplay)\n  );\n\n  useEffect(() => {\n    setTagOptions(\n      !articles\n        ? []\n        : [...new Set(articles.flatMap((articleMeta) => articleMeta.tag_list))]\n            .map((tag) => {\n              const count = articles.filter((articleMeta) =>\n                articleMeta.tag_list.includes(tag)\n              ).length;\n              return {\n                value: tag,\n                count,\n                label: `${tag} (${count})`,\n              };\n            })\n            .filter((option) => option.count > 0)\n            .sort((a, b) => b.count - a.count)\n    );\n  }, [articles]);\n\n  const handleChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    e.preventDefault();\n    setSearchText(e.target.value);\n  }, []);\n\n  const [isResetButtonAnimated, setIsResetButtonAnimated] = useState(false);\n\n  const resetOptions = useCallback(() => {\n    setSelectedTags([]);\n    setSelectedSort(defaultSort);\n    setSearchText(\"\");\n    setIsResetButtonAnimated(true);\n    setTimeout(() => {\n      setIsResetButtonAnimated(false);\n    }, 500);\n  }, []);\n\n  const shouldShrinkButtons = useMediaQuery(\"(max-width: 500px)\");\n\n  const navigate = useNavigate();\n\n  const [localStorageProjectOptions, setLocalStorageProjectOptions] =\n    useLocalStorage<BlogOptions>(\"blogOptions\", {\n      tags: [],\n      sort: defaultSort,\n      searchText: \"\",\n    });\n\n  const queryParams = useQueryParams();\n\n  useEffect(() => {\n    if (queryParams.toString()) {\n      // Query params take precedence over local storage on initial load\n      if (queryParams.get(\"reset\")) {\n        resetOptions();\n        navigate(\n          {\n            hash: window.location.hash,\n            search: \"\",\n          },\n          {\n            replace: true,\n          }\n        );\n        return () => {};\n      }\n      setSelectedTags([]);\n      decodeArrayAsCsv(queryParams.get(\"technologies\") ?? \"\").forEach(\n        (value) => {\n          const option = selectedTags.find(\n            (o) => o.value.toLowerCase() === value.toLowerCase()\n          );\n          if (option) {\n            setSelectedTags((prev) => [...prev, option]);\n          }\n        }\n      );\n      setSelectedSort(\n        sortOptions.find(\n          (o) =>\n            o.value.toLowerCase() === queryParams.get(\"sort\")?.toLowerCase()\n        ) ?? defaultSort\n      );\n      setSearchText(queryParams.get(\"searchText\") ?? \"\");\n    } else {\n      // Populate the options from local storage\n      setSelectedTags(localStorageProjectOptions.tags);\n      setSelectedSort(localStorageProjectOptions.sort);\n      setSearchText(localStorageProjectOptions.searchText);\n    }\n    return () => {};\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    // Update local storage when options change\n    setLocalStorageProjectOptions({\n      tags: selectedTags,\n      sort: selectedSort,\n      searchText,\n    });\n    // Update query params\n    navigate(\n      {\n        hash: window.location.hash,\n        search: `?${new URLSearchParams(\n          // Strip any undefined values\n          JSON.parse(\n            JSON.stringify({\n              tags:\n                encodeArrayAsCsv(selectedTags.map((t) => t.value)) || undefined,\n              sort:\n                selectedSort.value === sortOptions[0]?.value\n                  ? undefined\n                  : selectedSort.value,\n              searchText: searchText || undefined,\n            })\n          )\n        ).toString()}`,\n      },\n      {\n        replace: true,\n      }\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchText, selectedSort, selectedTags]);\n\n  const filteredArticles = useMemo(\n    () =>\n      status === \"loading\" || status === \"error\" || !articles\n        ? []\n        : articles\n            .sort(sortByPopularity)\n            .sort(sortFuncFromOption(selectedSort.value))\n            .filter((articleMeta) => {\n              const tags = selectedTags.map((tag) => tag.value);\n              return (\n                searchFilter(searchText, articleMeta) &&\n                (selectedTags.length === 0 ||\n                  (typeof articleMeta.tag_list !== \"string\" &&\n                    articleMeta.tag_list.filter((articleTag) =>\n                      tags.includes(articleTag)\n                    ).length !== 0))\n              );\n            })\n            .map((articleMeta, index) => (\n              <BlogCard article={articleMeta} key={index} />\n            )),\n    [articles, searchText, selectedSort.value, selectedTags, status]\n  );\n\n  return (\n    <div>\n      <FadeIn transitionDuration={200}>\n        <div\n          className={cn(\n            \"mx-auto mb-8 flex max-w-2xl items-center justify-center gap-4\",\n            \"flex-row\",\n            \"flex-wrap\"\n          )}\n        >\n          <Button\n            icon={<SiDevdotto />}\n            isLabelHidden={shouldShrinkButtons}\n            isLight\n            label=\"DEV.to\"\n            to=\"https://dev.to/timwjames\"\n            tooltip=\"Find my personal blog @timwjames\"\n          />\n          <Button\n            icon={<SiMedium />}\n            isLabelHidden={shouldShrinkButtons}\n            isLight\n            label=\"Medium\"\n            to=\"https://medium.com/@twjames\"\n            tooltip=\"Find my professional @twjames\"\n          />\n        </div>\n        <section\n          aria-label=\"Search Controls\"\n          className={cn(\n            \"mx-auto mb-4 flex place-content-center items-center\",\n            \"flex-col\"\n          )}\n        >\n          <div className={cn(\"flex w-full gap-4\")}>\n            <SearchField handleChange={handleChange} searchText={searchText} />\n            <Button\n              childProps={{ onClick: resetOptions, type: \"reset\" }}\n              className={\n                shouldShrinkButtons\n                  ? cn(\"!-mt-1 !px-2 !py-2 !text-3xl\")\n                  : cn(\"!-mt-1\", \"!h-[50px]\", \"!py-0\")\n              }\n              icon={\n                isResetButtonAnimated ? (\n                  <span\n                    className={cn(\n                      \"inline-block\",\n                      \"leading-0\",\n                      \"motion-safe:animate-spin\"\n                    )}\n                  >\n                    <RiRefreshFill />\n                  </span>\n                ) : (\n                  <RiRefreshFill />\n                )\n              }\n              iconRight\n              isLabelHidden={shouldShrinkButtons}\n              isLight\n              label=\"Reset\"\n              mode=\"button\"\n              tooltip=\"Reset search and filter options\"\n            />\n          </div>\n          <div className={cn(\"flex w-full gap-4\", \"flex-wrap\")}>\n            <div className={cn(\"z-30 min-w-fit grow\")}>\n              <SingleSelection\n                options={sortOptions}\n                selectedOption={selectedSort}\n                setSelectedOption={setSelectedSort}\n              />\n            </div>\n            <div className={cn(\"z-20 grow\")}>\n              <MultiSelection\n                options={tagOptions}\n                placeholder=\"Filter by tags...\"\n                selectedOptions={selectedTags}\n                setSelectedOptions={setSelectedTags}\n              />\n            </div>\n          </div>\n        </section>\n        <section\n          aria-label=\"Blogs\"\n          className={cn(\"flex justify-center gap-4 p-0\", \"flex-wrap\")}\n          data-chromatic=\"ignore\"\n        >\n          {status === \"loading\" ? (\n            [...Array(6).keys()].map((key) => <BlogCardLoading key={key} />)\n          ) : status === \"error\" || !articles ? (\n            <div className={cn(\"mb-8 text-center text-xl \")}>\n              <span className={cn(\"text-danger\")}>Something went wrong</span> -\n              Try again later\n            </div>\n          ) : filteredArticles.length === 0 ? (\n            <div className={cn(\"mb-8 text-center text-xl \")}>\n              <span className={cn(\"text-danger\")}>No articles found</span> - Try\n              a different filter\n            </div>\n          ) : (\n            filteredArticles\n          )}\n        </section>\n      </FadeIn>\n    </div>\n  );\n};\n\nexport default Blog;\n"],"names":["searchFilter","searchText","item","search","tag","defaultSort","sortOptions","articlesToDisplay","Blog","selectedTags","setSelectedTags","useState","selectedSort","setSelectedSort","tagOptions","setTagOptions","setSearchText","status","articles","useQuery","devdottoArticlesMeta","useEffect","articleMeta","count","option","a","b","handleChange","useCallback","e","isResetButtonAnimated","setIsResetButtonAnimated","resetOptions","shouldShrinkButtons","useMediaQuery","navigate","useNavigate","localStorageProjectOptions","setLocalStorageProjectOptions","useLocalStorage","queryParams","useQueryParams","decodeArrayAsCsv","value","o","prev","_a","encodeArrayAsCsv","t","filteredArticles","useMemo","sortByPopularity","sortFuncFromOption","tags","articleTag","index","jsx","BlogCard","jsxs","FadeIn","cn","Button","SiDevdotto","SiMedium","SearchField","RiRefreshFill","SingleSelection","MultiSelection","key","BlogCardLoading","BlogPage"],"mappings":"wuCA0BA,MAAMA,GAAe,CAACC,EAAoBC,IAA8B,CAChE,MAAAC,EAASF,EAAW,cAC1B,OACEE,EAAO,SAAW,GAClBD,EAAK,MAAM,YAAA,EAAc,SAASC,CAAM,GACxCD,EAAK,YAAY,YAAc,EAAA,SAASC,CAAM,GAC7C,OAAOD,EAAK,UAAa,UACxBA,EAAK,SAAS,KAAME,GAAQA,EAAI,YAAA,EAAc,SAASD,CAAM,CAAC,CAEpE,EASME,EAAcC,EAAY,CAAC,EAE3BC,EAAoB,GAEpBC,GAAO,IAAM,CACjB,KAAM,CAACC,EAAcC,CAAe,EAAIC,EAAA,SAA4B,CAAE,CAAA,EAChE,CAACC,EAAcC,CAAe,EAAIF,WAAqBN,CAAW,EAClE,CAACS,EAAYC,CAAa,EAAIJ,EAAA,SAA4B,CAAE,CAAA,EAC5D,CAACV,EAAYe,CAAa,EAAIL,WAAiB,EAAE,EAEjD,CAAE,OAAAM,EAAQ,KAAMC,CAAa,EAAAC,EACjC,CAAC,WAAY,eAAgBZ,EAAmB,CAAC,EACjDa,EAAqBb,CAAiB,CAAA,EAGxCc,EAAAA,UAAU,IAAM,CACdN,EACGG,EAEG,CAAC,GAAG,IAAI,IAAIA,EAAS,QAASI,GAAgBA,EAAY,QAAQ,CAAC,CAAC,EACjE,IAAKlB,GAAQ,CACZ,MAAMmB,EAAQL,EAAS,OAAQI,GAC7BA,EAAY,SAAS,SAASlB,CAAG,CACjC,EAAA,OACK,MAAA,CACL,MAAOA,EACP,MAAAmB,EACA,MAAO,GAAGnB,CAAG,KAAKmB,CAAK,GAAA,CACzB,CACD,EACA,OAAQC,GAAWA,EAAO,MAAQ,CAAC,EACnC,KAAK,CAACC,EAAGC,IAAMA,EAAE,MAAQD,EAAE,KAAK,EAbnC,CAAA,CAamC,CACzC,EACC,CAACP,CAAQ,CAAC,EAEP,MAAAS,EAAeC,cAAaC,GAA2C,CAC3EA,EAAE,eAAe,EACHb,EAAAa,EAAE,OAAO,KAAK,CAC9B,EAAG,CAAE,CAAA,EAEC,CAACC,EAAuBC,CAAwB,EAAIpB,WAAS,EAAK,EAElEqB,EAAeJ,EAAAA,YAAY,IAAM,CACrClB,EAAgB,CAAE,CAAA,EAClBG,EAAgBR,CAAW,EAC3BW,EAAc,EAAE,EAChBe,EAAyB,EAAI,EAC7B,WAAW,IAAM,CACfA,EAAyB,EAAK,GAC7B,GAAG,CACR,EAAG,CAAE,CAAA,EAECE,EAAsBC,GAAc,oBAAoB,EAExDC,EAAWC,IAEX,CAACC,EAA4BC,CAA6B,EAC9DC,GAA6B,cAAe,CAC1C,KAAM,CAAC,EACP,KAAMlC,EACN,WAAY,EAAA,CACb,EAEGmC,EAAcC,KAEpBpB,EAAAA,UAAU,IAAM,CACV,GAAAmB,EAAY,WAAY,CAEtB,GAAAA,EAAY,IAAI,OAAO,EACZ,OAAAR,IACbG,EACE,CACE,KAAM,OAAO,SAAS,KACtB,OAAQ,EACV,EACA,CACE,QAAS,EACX,CAAA,EAEK,IAAM,CAAA,EAEfzB,EAAgB,CAAE,CAAA,EAClBgC,GAAiBF,EAAY,IAAI,cAAc,GAAK,EAAE,EAAE,QACrDG,GAAU,CACT,MAAMnB,EAASf,EAAa,KACzBmC,GAAMA,EAAE,MAAM,YAAY,IAAMD,EAAM,YAAY,CAAA,EAEjDnB,GACFd,EAAiBmC,GAAS,CAAC,GAAGA,EAAMrB,CAAM,CAAC,CAE/C,CAAA,EAEFX,EACEP,EAAY,KACTsC,GACC,OAAA,OAAAA,EAAE,MAAM,YAAA,MAAkBE,EAAAN,EAAY,IAAI,MAAM,IAAtB,YAAAM,EAAyB,eAAY,GAC9DzC,CAAA,EAEPW,EAAcwB,EAAY,IAAI,YAAY,GAAK,EAAE,CAAA,MAGjD9B,EAAgB2B,EAA2B,IAAI,EAC/CxB,EAAgBwB,EAA2B,IAAI,EAC/CrB,EAAcqB,EAA2B,UAAU,EAErD,MAAO,IAAM,CAAA,CAEf,EAAG,CAAE,CAAA,EAELhB,EAAAA,UAAU,IAAM,OAEgBiB,EAAA,CAC5B,KAAM7B,EACN,KAAMG,EACN,WAAAX,CAAA,CACD,EAEDkC,EACE,CACE,KAAM,OAAO,SAAS,KACtB,OAAQ,IAAI,IAAI,gBAEd,KAAK,MACH,KAAK,UAAU,CACb,KACEY,GAAiBtC,EAAa,IAAKuC,GAAMA,EAAE,KAAK,CAAC,GAAK,OACxD,KACEpC,EAAa,UAAUkC,EAAAxC,EAAY,CAAC,IAAb,YAAAwC,EAAgB,OACnC,OACAlC,EAAa,MACnB,WAAYX,GAAc,MAAA,CAC3B,CACH,CAAA,EACA,SAAU,CAAA,EACd,EACA,CACE,QAAS,EACX,CAAA,CAGD,EAAA,CAACA,EAAYW,EAAcH,CAAY,CAAC,EAE3C,MAAMwC,EAAmBC,EAAA,QACvB,IACEjC,IAAW,WAAaA,IAAW,SAAW,CAACC,EAC3C,CACA,EAAAA,EACG,KAAKiC,CAAgB,EACrB,KAAKC,EAAmBxC,EAAa,KAAK,CAAC,EAC3C,OAAQU,GAAgB,CACvB,MAAM+B,EAAO5C,EAAa,IAAKL,GAAQA,EAAI,KAAK,EAChD,OACEJ,GAAaC,EAAYqB,CAAW,IACnCb,EAAa,SAAW,GACtB,OAAOa,EAAY,UAAa,UAC/BA,EAAY,SAAS,OAAQgC,GAC3BD,EAAK,SAASC,CAAU,CAAA,EACxB,SAAW,EAEpB,CAAA,EACA,IAAI,CAAChC,EAAaiC,IACjBC,EAAAA,IAACC,EAAS,CAAA,QAASnC,CAAkB,EAAAiC,CAAO,CAC7C,EACT,CAACrC,EAAUjB,EAAYW,EAAa,MAAOH,EAAcQ,CAAM,CAAA,EAGjE,OACGuC,EAAA,IAAA,MAAA,CACC,SAACE,EAAAA,KAAAC,GAAA,CAAO,mBAAoB,IAC1B,SAAA,CAAAD,EAAA,KAAC,MAAA,CACC,UAAWE,EACT,gEACA,WACA,WACF,EAEA,SAAA,CAAAJ,EAAA,IAACK,EAAA,CACC,WAAOC,GAAW,EAAA,EAClB,cAAe7B,EACf,QAAO,GACP,MAAM,SACN,GAAG,2BACH,QAAQ,kCAAA,CACV,EACAuB,EAAA,IAACK,EAAA,CACC,WAAOE,GAAS,EAAA,EAChB,cAAe9B,EACf,QAAO,GACP,MAAM,SACN,GAAG,8BACH,QAAQ,+BAAA,CACV,CAAA,CAAA,CACF,EACAyB,EAAA,KAAC,UAAA,CACC,aAAW,kBACX,UAAWE,EACT,sDACA,UACF,EAEA,SAAA,CAAAF,EAAA,KAAC,MAAI,CAAA,UAAWE,EAAG,mBAAmB,EACpC,SAAA,CAACJ,EAAAA,IAAAQ,EAAA,CAAY,aAAArC,EAA4B,WAAA1B,CAAwB,CAAA,EACjEuD,EAAA,IAACK,EAAA,CACC,WAAY,CAAE,QAAS7B,EAAc,KAAM,OAAQ,EACnD,UACEC,EACI2B,EAAG,8BAA8B,EACjCA,EAAG,SAAU,YAAa,OAAO,EAEvC,KACE9B,EACE0B,EAAA,IAAC,OAAA,CACC,UAAWI,EACT,eACA,YACA,0BACF,EAEA,eAACK,EAAc,EAAA,CAAA,CAAA,QAGhBA,EAAc,EAAA,EAGnB,UAAS,GACT,cAAehC,EACf,QAAO,GACP,MAAM,QACN,KAAK,SACL,QAAQ,iCAAA,CACV,CAAA,EACF,SACC,MAAI,CAAA,UAAW2B,EAAG,oBAAqB,WAAW,EACjD,SAAA,CAAAJ,EAAA,IAAC,MAAI,CAAA,UAAWI,EAAG,qBAAqB,EACtC,SAAAJ,EAAA,IAACU,EAAA,CACC,QAAS5D,EACT,eAAgBM,EAChB,kBAAmBC,CAAA,CAAA,EAEvB,EACC2C,EAAA,IAAA,MAAA,CAAI,UAAWI,EAAG,WAAW,EAC5B,SAAAJ,EAAA,IAACW,EAAA,CACC,QAASrD,EACT,YAAY,oBACZ,gBAAiBL,EACjB,mBAAoBC,CAAA,CAAA,EAExB,CAAA,EACF,CAAA,CAAA,CACF,EACA8C,EAAA,IAAC,UAAA,CACC,aAAW,QACX,UAAWI,EAAG,gCAAiC,WAAW,EAC1D,iBAAe,SAEd,SAAA3C,IAAW,UACV,CAAC,GAAG,MAAM,CAAC,EAAE,KAAK,CAAC,EAAE,IAAKmD,GAASZ,EAAA,IAAAa,EAAA,GAAqBD,CAAK,CAAE,EAC7DnD,IAAW,SAAW,CAACC,EACzBwC,EAAAA,KAAC,MAAI,CAAA,UAAWE,EAAG,2BAA2B,EAC5C,SAAA,CAAAJ,MAAC,OAAK,CAAA,UAAWI,EAAG,aAAa,EAAG,SAAoB,uBAAA,EAAO,oBAEjE,CAAA,CAAA,EACEX,EAAiB,SAAW,SAC7B,MAAI,CAAA,UAAWW,EAAG,2BAA2B,EAC5C,SAAA,CAAAJ,MAAC,OAAK,CAAA,UAAWI,EAAG,aAAa,EAAG,SAAiB,oBAAA,EAAO,2BAAA,CAAA,CAE9D,EAEAX,CAAA,CAEJ,CAAA,CACF,CAAA,CACF,CAAA,CAEJ,EAEAqB,EAAe9D;;;;;;;;;"}